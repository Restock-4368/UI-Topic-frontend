import{S as D}from"./supply-batch.service-ZeJMefWU.js";import{_ as C,d as c,b as r,t as m,F as N,j as A,n as O,m as F,l as B,O as I,K as L,o as d}from"./index-CDiCqaA3.js";import{S as $}from"./supply.service-C_JuCXEk.js";import{S as M,O as P,a as j}from"./order-to-supplier-situation.assembler-CS395Hhl.js";import{S as z}from"./supply.assembler-CSpomLG2.js";import"./supply-batch.entity-DarSUpWa.js";const K={name:"RestaurantNotificationsComponent",data(){return{tabs:["All","Inventory","Orders"],activeTab:"All",notifications:[]}},async created(){await this.loadNotifications()},methods:{formatDate(a){return a?new Date(a).toLocaleDateString():" "},async loadNotifications(){try{const a=new D,i=new $,s=new F,S=new B,n=new I,[l,o,p,R,E]=await Promise.all([a.getAll(),i.getAll(),s.getAll(),S.getAll(),n.getAll()]),v=M.toEntitiesFromResponse(l);console.log("Batches loaded:",v);const h=z.toEntitiesFromResponse(o),T=L.toEntitiesFromResponse(p),g=P.toEntitiesFromResponse(R),_=j.toEntitiesFromResponse(E);console.log("Supplies loaded:",h);const k=new Map;h.forEach(e=>k.set(Number(e.id),e));const u=[];v.forEach(e=>{const t=k.get(Number(e.supply_id));t&&(e.stock<=t.min_stock?u.push({type:"inventory",date:e.expiration_date,data:{key:"notifications.messages.lowStock",params:{supply:t.name,id:e.id,stock:e.stock,min:t.min_stock}}}):e.stock>=t.max_stock&&u.push({type:"inventory",date:e.expiration_date,data:{key:"notifications.messages.maxStock",params:{supply:t.name,id:e.id,stock:e.stock,max:t.max_stock}}}))});const b=_.find(e=>e.name.toLowerCase()==="pending"),x=g.find(e=>e.name.toLowerCase()==="delivered"),f=[];T.forEach(e=>{const t=_.find(y=>Number(y.id)===Number(e.situationId)),w=g.find(y=>Number(y.id)===Number(e.stateId));t&&b&&Number(t.id)!==Number(b.id)&&f.push({type:"order",date:e.date,data:{key:"notifications.messages.orderSituation",params:{id:e.id,situation:t.name}}}),w&&x&&Number(w.id)===Number(x.id)&&f.push({type:"order",date:e.date,data:{key:"notifications.messages.orderDelivered",params:{id:e.id}}})}),this.notifications=[...u,...f].sort((e,t)=>new Date(t.date)-new Date(e.date))}catch(a){console.error("Error loading notifications",a)}}},computed:{displayedNotifications(){const a=s=>this.$t(s.data.key,s.data.params),i=this.notifications.map(s=>({...s,message:a(s)}));switch(this.activeTab){case"Inventory":return i.filter(s=>s.type==="inventory");case"Orders":return i.filter(s=>s.type==="order");default:return i}}}},V={class:"p-6"},q={class:"text-xl font-semibold mb-6"},G={class:"flex space-x-4 mb-4"},H=["onClick"],J={class:"m-0 font-medium"},Q={class:"text-xs text-gray-500"};function U(a,i,s,S,n,l){return d(),c("div",V,[r("h2",q,m(a.$t("notifications.title")),1),r("div",G,[(d(!0),c(N,null,A(n.tabs,o=>(d(),c("button",{key:o,onClick:p=>n.activeTab=o,class:O(["px-4 py-2 rounded",n.activeTab===o?"bg-green-700 text-white":"bg-gray-200 text-gray-700"])},m(a.$t(`notifications.tabs.${o.toLowerCase()}`)),11,H))),128))]),r("div",null,[(d(!0),c(N,null,A(l.displayedNotifications,(o,p)=>(d(),c("div",{key:p,class:"p-4 surface-card shadow-2 flex flex-column gap-2"},[r("i",{class:O([o.type==="inventory"?"pi pi-box text-yellow-600":"pi pi-truck text-green-600","text-lg"])},null,2),r("p",J,m(o.message),1),r("span",Q,m(l.formatDate(o.date)),1)]))),128))])])}const se=C(K,[["render",U],["__scopeId","data-v-eb50c93a"]]);export{se as default};
