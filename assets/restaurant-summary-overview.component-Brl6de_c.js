import{O as W}from"./order-to-supplier-table.component-Dtis0pTS.js";import{_ as x,d as _,o as m,b as s,e as L,F as R,j as A,n as N,t as f,k as z,O as D,l as B,U as j,P as q,m as E,r as $,p as Q,q as G,g as b,c as C,a as w,f as h,i as T,s as H}from"./index-BPx0zh6T.js";import{S as I}from"./supply-batch.service-2mzdXacD.js";import{S as U}from"./supply.service-CTib3cY-.js";import{S as J}from"./supply-category.service-DG2za2yw.js";const K={name:"RestaurantPendingOrdersWidget",components:{OrderToSupplierTable:W},data(){return{allOrders:[],suppliers:[],situations:[],situationFilter:null}},computed:{visibleSituations(){const c=new Set(this.allOrders.map(e=>{var l;return(l=e.situation)==null?void 0:l.name}).filter(Boolean));return this.situations.filter(e=>c.has(e.name))},filteredOrders(){return this.situationFilter?this.allOrders.filter(c=>{var e,l;return((l=(e=c.situation)==null?void 0:e.name)==null?void 0:l.toLowerCase())===this.situationFilter.toLowerCase()}):[]}},async mounted(){console.log("â³ Cargando Ã³rdenes, situaciones y estados...");const c=await z(),e=new D,l=new B,[g,v]=await Promise.all([e.getAll(),l.getAll()]),a=g.data||[],t=v.data||[];this.situations=a;const o=new Map(a.map(p=>[p.id,p])),u=new Map(t.map(p=>[p.id,p])),r=c.map(p=>(p.situation=o.get(Number(p.situationId))||null,p.state=u.get(Number(p.stateId))||null,p));console.log("ðŸ“¦ Ã“rdenes enriquecidas: ",r),this.allOrders=r,this.situationFilter=this.visibleSituations.length===1?this.visibleSituations[0].name:"Pending";const i=new j,d=new q,n=((await i.getByRoleId(1)).data||[]).map(p=>d.getByQuery("user_id",p.id)),O=(await Promise.all(n)).flatMap(p=>p.data||[]);this.suppliers=O.map(p=>({id:p.user_id,name:p.name}))},methods:{goToOrders(){this.$router.push("/dashboard/restaurant/orders")},setFilter(c){this.situationFilter=c},formatDate(c){return new Date(c).toLocaleDateString()},getSupplierName(c){const e=this.suppliers.find(l=>l.id===c);return e?e.name:"Unknown"}}},X={key:0,class:"filter-buttons"},Y=["onClick"],Z={class:"widget-containern"},tt={class:"widget-orders-wrapper"},et={class:"scroll-wrapper"},st={class:"custom-orders-table"},at={class:"orders-widget-table"},nt={class:"view-all-button-container"};function rt(c,e,l,g,v,a){return m(),_("div",null,[e[3]||(e[3]=s("h3",{class:"widget-title"},"My Orders",-1)),a.visibleSituations.length?(m(),_("div",X,[(m(!0),_(R,null,A(a.visibleSituations,t=>(m(),_("button",{key:t.id,class:N(["filter-btn",{active:v.situationFilter===t.name}]),onClick:o=>a.setFilter(t.name)},f(t.name),11,Y))),128))])):L("",!0),s("div",Z,[s("div",tt,[s("div",et,[s("div",st,[s("table",at,[e[1]||(e[1]=s("thead",null,[s("tr",null,[s("th",null,"Date"),s("th",null,"Supplier"),s("th",null,"State"),s("th",null,"Total")])],-1)),s("tbody",null,[(m(!0),_(R,null,A(a.filteredOrders,t=>{var o;return m(),_("tr",{key:t.id},[s("td",null,f(a.formatDate(t.date)),1),s("td",null,f(a.getSupplierName(t.supplierId)),1),s("td",null,f(((o=t.state)==null?void 0:o.name)||"-"),1),s("td",null,"S/ "+f(t.totalPrice.toFixed(2)),1)])}),128))])])])]),s("div",nt,[s("button",{onClick:e[0]||(e[0]=(...t)=>a.goToOrders&&a.goToOrders(...t)),class:"view-all-btn",title:"Ver todas las Ã³rdenes"},e[2]||(e[2]=[s("i",{class:"pi pi-arrow-right"},null,-1)]))])])])])}const it=x(K,[["render",rt]]),ot={name:"RestaurantLastSuppliesWidget",data(){return{batches:[]}},async mounted(){const c=new I,e=new U,l=new J,[g,v,a]=await Promise.all([c.getAll(),e.getAll(),l.getAll()]),t=g.data||[],o=v.data||[],u=a.data||[],r=Object.fromEntries(u.map(i=>[i.id,i]));this.batches=t.map(i=>{const d=o.find(y=>y.id===i.supply_id);return d?{...i,supply:{...d,category:r[d.category_id]||null}}:null}).filter(i=>i!==null).sort((i,d)=>{const y=i.created_at||i.id||0;return(d.created_at||d.id||0)-y}).slice(0,10)},methods:{getPairs(){const c=[];for(let e=0;e<this.batches.length;e+=2)c.push(this.batches.slice(e,e+2));return c},scrollLeft(){this.$refs.carousel.scrollBy({left:-220,behavior:"smooth"})},scrollRight(){this.$refs.carousel.scrollBy({left:220,behavior:"smooth"})}}},lt={class:"last-supplies-wrapper"},ct={class:"carousel-wrapper"},ut={ref:"carousel",class:"carousel-container"},dt={class:"category"},pt={class:"description"},mt={class:"supplies-grid"},vt={class:"category"};function _t(c,e,l,g,v,a){return m(),_("div",lt,[e[4]||(e[4]=s("h3",{class:"widget-title"},"Last added supplies",-1)),s("div",ct,[s("button",{class:"nav-button left",onClick:e[0]||(e[0]=(...t)=>a.scrollLeft&&a.scrollLeft(...t))},e[2]||(e[2]=[s("i",{class:"pi pi-chevron-left"},null,-1)])),s("div",ut,[(m(!0),_(R,null,A(v.batches,(t,o)=>{var u,r,i,d;return m(),_("div",{class:"supply-card",key:o},[s("h4",null,f((u=t.supply)==null?void 0:u.name),1),s("p",dt,f(((i=(r=t.supply)==null?void 0:r.category)==null?void 0:i.name)||"Uncategorized"),1),s("p",pt,f(((d=t.supply)==null?void 0:d.description)||"-"),1)])}),128))],512),s("button",{class:"nav-button right",onClick:e[1]||(e[1]=(...t)=>a.scrollRight&&a.scrollRight(...t))},e[3]||(e[3]=[s("i",{class:"pi pi-chevron-right"},null,-1)]))]),s("div",mt,[(m(!0),_(R,null,A(a.getPairs(),(t,o)=>(m(),_("div",{class:"ingredient-pair",key:o},[(m(!0),_(R,null,A(t,(u,r)=>{var i,d,y;return m(),_("div",{class:"ingredient-card",key:r},[s("h4",null,f((i=u.supply)==null?void 0:i.name),1),s("p",vt,f(((y=(d=u.supply)==null?void 0:d.category)==null?void 0:y.name)||"Uncategorized"),1)])}),128))]))),128))])])}const gt=x(ot,[["render",_t],["__scopeId","data-v-1d8c0c1c"]]);function ft(){async function c(){const l=new I,g=new U,[v,a]=await Promise.all([l.getAll(),g.getAll()]),t=v.data,o=a.data;return t.filter(u=>u.supply_id).map(u=>{const r=o.find(k=>k.id===u.supply_id),i=u.stock??0,d=(r==null?void 0:r.min_stock)??0,y=(r==null?void 0:r.max_stock)??1/0;return{ingredient:(r==null?void 0:r.name)??"Unknown",status:i<=d?"Low stock":i>=y?"Max stock":"Normal"}}).filter(u=>u.status!=="Normal")}async function e(){const l=new E,g=new B,v=new D,[a,t,o]=await Promise.all([l.getAll(),g.getAll(),v.getAll()]),u=Array.isArray(a.data)?a.data:[],r=Array.isArray(t.data)?t.data:[],i=Array.isArray(o.data)?o.data:[],d=new Map(r.map(n=>[n.id,n])),y=new Map(i.map(n=>[n.id,n])),k=u.map(n=>{var F,M;const S=d.get(n.order_to_supplier_state_id),O=y.get(n.order_to_supplier_situation_id),p=((F=S==null?void 0:S.name)==null?void 0:F.toLowerCase())||"",P=((M=O==null?void 0:O.name)==null?void 0:M.toLowerCase())||"";if(!(p==="delivered"||P&&P!=="pending"))return null;const V=p==="delivered"?"Delivered":`Updated to ${(O==null?void 0:O.name)||"Unknown"}`;return{ingredient:`Order #${n.id}`,status:V,date:new Date(n.date||n.updated_at||null)}}).filter(Boolean).sort((n,S)=>S.date-n.date);return console.log("ðŸ“¦ Final orderAlerts:",k),k}return{getInventoryAlerts:c,getOrderAlerts:e}}const yt={class:"widget-container"},wt={key:1,class:"no-notifications"},ht={__name:"restaurant-notifications-widget.component",setup(c){const e=$("inventory"),l=$([]),g=$([]),v=Q(()=>{var t,o;const a=[];return(t=l.value)!=null&&t.length&&a.push("inventory"),(o=g.value)!=null&&o.length&&a.push("orders"),a});return G(async()=>{const{getInventoryAlerts:a,getOrderAlerts:t}=ft();l.value=await a()||[],g.value=await t()||[],v.value.length>0&&(e.value=v.value[0])}),(a,t)=>{const o=b("pv-tab"),u=b("pv-tab-list"),r=b("pv-column"),i=b("pv-data-table"),d=b("pv-tab-panel"),y=b("pv-tab-panels"),k=b("pv-tabs");return m(),_("div",null,[t[3]||(t[3]=s("h3",{class:"widget-title"},"Last Notifications",-1)),s("div",yt,[v.value.length?(m(),C(k,{key:0,value:e.value,"onUpdate:value":t[0]||(t[0]=n=>e.value=n),class:"custom-tabs"},{default:w(()=>[h(u,{class:"custom-tablist"},{default:w(()=>{var n,S;return[(n=l.value)!=null&&n.length?(m(),C(o,{key:0,value:"inventory"},{default:w(()=>t[1]||(t[1]=[T("Inventory")])),_:1})):L("",!0),(S=g.value)!=null&&S.length?(m(),C(o,{key:1,value:"orders"},{default:w(()=>t[2]||(t[2]=[T("Orders")])),_:1})):L("",!0)]}),_:1}),h(y,{class:"scroll-wrappern"},{default:w(()=>[h(d,{value:"inventory"},{default:w(()=>[h(i,{value:l.value,responsiveLayout:"scroll"},{default:w(()=>[h(r,{field:"ingredient",header:"Supplies"},{body:w(({data:n})=>[s("span",null,f(n.ingredient),1)]),_:1}),h(r,{field:"status",header:"Status"},{body:w(({data:n})=>[s("span",{class:N(["status-badge",n.status==="Low stock"?"low-stock":"max-stock"])},f(n.status),3)]),_:1})]),_:1},8,["value"])]),_:1}),h(d,{value:"orders"},{default:w(()=>[h(i,{value:g.value,responsiveLayout:"scroll"},{default:w(()=>[h(r,{field:"ingredient",header:"Order"},{body:w(({data:n})=>[s("span",null,f(n.ingredient),1)]),_:1}),h(r,{field:"status",header:"Status"},{body:w(({data:n})=>[s("span",{class:N(["status-badge",n.status.includes("Delivered")?"low-stock":"max-stock"])},f(n.status),3)]),_:1})]),_:1},8,["value"])]),_:1})]),_:1})]),_:1},8,["value"])):(m(),_("p",wt,"No notifications to display"))])])}}},bt=H({name:"restaurant-summary-overview",components:{RestaurantNotificationsWidgetComponent:ht,RestaurantLastSuppliesWidget:gt,RestaurantPendingOrdersWidget:it}}),St={class:"restaurant-summary-overview"},kt={class:"summary-row summary-row-1"},Ot={class:"summary-row summary-row-2"};function Rt(c,e,l,g,v,a){const t=b("restaurant-pending-orders-widget"),o=b("restaurant-notifications-widget-component"),u=b("restaurant-last-supplies-widget");return m(),_("div",St,[s("div",kt,[h(t,{class:"widget widget-pending"}),h(o,{class:"widget widget-alerts"})]),s("div",Ot,[h(u,{class:"widget widget-supplies"})])])}const Pt=x(bt,[["render",Rt]]);export{Pt as default};
