import{R as P,_ as T,d as c,b as t,t as i,e as S,F as R,j as D,N,o as r,h as $,S as B,u as U,c as q,i as L,g as w,f as b,a as Q,T as z}from"./index-CDiCqaA3.js";import{a as E,R as G}from"./recipe-supply.service-CB9iQc9I.js";import{S as V}from"./supply.service-C_JuCXEk.js";import{S as K}from"./supply-batch.service-ZeJMefWU.js";const X="/sales";class H extends P{constructor(){super(),this.resourceEndpoint=X}}const Z="/sales_recipes";class F extends P{constructor(){super(),this.resourceEndpoint=Z}}const x="/sales_additional_supplies";class O extends P{constructor(){super(),this.resourceEndpoint=x}}const ee={name:"sale-detail",props:{sale:{type:Object,required:!0}},data(){return{dishes:[],additionalSupplies:[]}},methods:{closeComponent(){this.$emit("close")}},created(){this.dishes=this.sale.dishes||[],this.additionalSupplies=this.sale.additionalSupplies||[]}},te={class:"title"},se={class:"content"},le={class:"sub-text"},ae={class:"sub-text"},ie={class:"sub-text"},ne={class:"dishes"},oe={class:"subtitle2"},re={key:0,class:"custom-table"},de={key:1,class:"no-dishes"},ce={class:"additionalSupplies"},ue={class:"subtitle2"},pe={key:0,class:"custom-table"},he={key:1,class:"no-additionalSupplies"};function _e(e,s,o,u,n,l){return r(),c("div",{class:"modal-overlay",onClick:s[2]||(s[2]=(...a)=>l.closeComponent&&l.closeComponent(...a))},[t("div",{class:"modal-content modal-scrollable",onClick:s[1]||(s[1]=N(()=>{},["stop"]))},[t("button",{class:"close-button",onClick:s[0]||(s[0]=(...a)=>l.closeComponent&&l.closeComponent(...a))},s[3]||(s[3]=[t("i",{class:"pi pi-times",style:{"font-size":"1.5rem",color:"#808D99"}},null,-1)])),t("h2",te,i(e.$t("sales_restaurant.sale_details.title"))+' "'+i(o.sale.code)+'"',1),t("div",se,[t("p",le,i(e.$t("sales_restaurant.sale_details.name_customer"))+": "+i(o.sale.diner_name||""),1),t("p",ae,i(e.$t("sales_restaurant.sale_details.number_dishes"))+": "+i(o.sale.recipeCount||0),1),t("p",ie,i(e.$t("sales_restaurant.sale_details.number_additional_supplies"))+": "+i(o.sale.additionalSupplyCount||0),1),s[4]||(s[4]=t("hr",null,null,-1)),t("div",ne,[t("h3",oe,i(e.$t("sales_restaurant.sale_details.dishes")),1),this.dishes.length>0?(r(),c("table",re,[t("thead",null,[t("tr",null,[t("th",null,i(e.$t("sales_restaurant.sale_details.name")),1),t("th",null,i(e.$t("sales_restaurant.sale_details.unit_price")),1),t("th",null,i(e.$t("sales_restaurant.sale_details.quantity")),1)])]),t("tbody",null,[(r(!0),c(R,null,D(n.dishes,(a,d)=>(r(),c("tr",{key:d},[t("td",null,i(a.name),1),t("td",null,"S/ "+i(a.unitPrice),1),t("td",null,i(a.quantity),1)]))),128))])])):S("",!0),this.dishes.length==0?(r(),c("p",de,"No dishes selected")):S("",!0)]),t("div",ce,[t("h3",ue,i(e.$t("sales_restaurant.sale_details.additional_supplies")),1),this.additionalSupplies.length>0?(r(),c("table",pe,[t("thead",null,[t("tr",null,[t("th",null,i(e.$t("sales_restaurant.sale_details.name")),1),t("th",null,i(e.$t("sales_restaurant.sale_details.unit_price")),1),t("th",null,i(e.$t("sales_restaurant.sale_details.quantity")),1)])]),t("tbody",null,[(r(!0),c(R,null,D(n.additionalSupplies,a=>(r(),c("tr",{key:a.id},[t("td",null,i(a.name),1),t("td",null,"S/ "+i(a.unitPrice),1),t("td",null,i(a.quantity),1)]))),128))])])):S("",!0),this.additionalSupplies.length==0?(r(),c("p",he,"No additional Supplies selected")):S("",!0)])])])])}const Y=T(ee,[["render",_e],["__scopeId","data-v-a3204e6b"]]),Se={name:"register-sales",props:[],data(){return{selectedDishId:"",selectedAdditionalSupplyId:"",selectedDishes:[],selectedAdditionalSupplies:[],availableDishes:[],availableAdditionalSupplies:[]}},methods:{closeComponent(){this.$emit("close")},agregarPlato(){const e=this.selectedDishId,s=this.availableDishes.find(u=>u.id===e),o=this.selectedDishes;s&&!o.find(u=>u.id===e)&&(o.push({...s,quantity:1}),this.selectedDishes=[...o])},agregarInsumo(){const e=this.selectedAdditionalSupplyId,s=this.availableAdditionalSupplies.find(u=>u.id===e),o=this.selectedAdditionalSupplies;s&&!o.find(u=>u.id===e)&&(o.push({...s,quantity:1}),this.selectedAdditionalSupplies=[...o])},deleteDish(e){console.log(e),this.selectedDishes=this.selectedDishes.filter(s=>s.id!==e),console.log("selectedDishes: ",this.selectedDishes)},deleteAdditionalSupply(e){this.selectedAdditionalSupplies=this.selectedAdditionalSupplies.filter(s=>s.id!==e),console.log("selectedAdditionalSupplies: ",this.selectedAdditionalSupplies)},registerSale(){const e=this.selectedDishes||[],s=this.selectedAdditionalSupplies||[];if(e.length===0&&s.length===0){alert("Please select at least one dish or supply before registering the sale.");return}this.$emit("register-sale",{dishes:e,additionalSupplies:s})},async getAllRecipes(){try{const e=await this.recipeService.getAll();this.availableDishes=e.data||[]}catch(e){console.error("Error al obtener recetas:",e)}},async getAllAdditionalSupplies(){try{const e=await this.supplyService.getAll();this.availableAdditionalSupplies=e.data||[]}catch(e){console.error("Error al obtener insumos adicionales:",e)}}},created(){this.recipeService=new E,this.supplyService=new V,this.getAllRecipes(),this.getAllAdditionalSupplies()}},ye={class:"title"},me={class:"content"},ge={class:"sub-text"},ve={disabled:"",value:""},fe=["value"],Ae={disabled:"",value:""},Ce=["value"],be={key:0},we={class:"custom-table"},ke=["onUpdate:modelValue"],Re=["onClick"],De={key:1},Me={class:"margin-top"},Ie={class:"custom-table"},$e=["onUpdate:modelValue"],qe=["onClick"],Te={key:2,class:"no-dishes-additonalsupplies-selected"},Pe={class:"buttons"};function Ne(e,s,o,u,n,l){return r(),c("div",{class:"modal-overlay",onClick:s[8]||(s[8]=(...a)=>l.closeComponent&&l.closeComponent(...a))},[t("div",{class:"modal-content modal-scrollable",onClick:s[7]||(s[7]=N(()=>{},["stop"]))},[t("button",{class:"close-button",onClick:s[0]||(s[0]=(...a)=>l.closeComponent&&l.closeComponent(...a))}," ✕ "),t("h2",ye,i(e.$t("sales_restaurant.register_sale_modal.title")),1),t("div",me,[t("p",ge,i(e.$t("sales_restaurant.register_sale_modal.sub-title")),1),t("p",null,i(e.$t("sales_restaurant.register_sale_modal.dishes")),1),$(t("select",{class:"full-width","onUpdate:modelValue":s[1]||(s[1]=a=>n.selectedDishId=a),onChange:s[2]||(s[2]=(...a)=>l.agregarPlato&&l.agregarPlato(...a))},[t("option",ve,i(e.$t("sales_restaurant.register_sale_modal.select_dish")),1),(r(!0),c(R,null,D(n.availableDishes,a=>(r(),c("option",{key:a.id,value:a.id},i(a.name),9,fe))),128))],544),[[B,n.selectedDishId]]),t("p",null,i(e.$t("sales_restaurant.register_sale_modal.additionalSuppllies")),1),$(t("select",{class:"full-width","onUpdate:modelValue":s[3]||(s[3]=a=>n.selectedAdditionalSupplyId=a),onChange:s[4]||(s[4]=(...a)=>l.agregarInsumo&&l.agregarInsumo(...a))},[t("option",Ae,i(e.$t("sales_restaurant.register_sale_modal.select_additionalSupply")),1),(r(!0),c(R,null,D(n.availableAdditionalSupplies,a=>(r(),c("option",{key:a.id,value:a.id},i(a.name),9,Ce))),128))],544),[[B,n.selectedAdditionalSupplyId]]),n.selectedDishes.length>0?(r(),c("div",be,[t("h3",null,i(e.$t("sales_restaurant.register_sale_modal.selected_dishes")),1),t("table",we,[t("thead",null,[t("tr",null,[t("th",null,i(e.$t("sales_restaurant.register_sale_modal.name")),1),t("th",null,i(e.$t("sales_restaurant.register_sale_modal.unit_price")),1),t("th",null,i(e.$t("sales_restaurant.register_sale_modal.quantity")),1),t("th",null,i(e.$t("sales_restaurant.register_sale_modal.actions")),1)])]),t("tbody",null,[(r(!0),c(R,null,D(n.selectedDishes,(a,d)=>(r(),c("tr",{key:d},[t("td",null,i(a.name),1),t("td",null,"S/ "+i(a.total_price),1),t("td",null,[$(t("input",{type:"number","onUpdate:modelValue":p=>a.quantity=p,min:"1"},null,8,ke),[[U,a.quantity,void 0,{number:!0}]])]),t("td",null,[t("i",{class:"pi pi-trash actions",onClick:p=>l.deleteDish(a.id)},null,8,Re)])]))),128))])])])):S("",!0),n.selectedAdditionalSupplies.length>0?(r(),c("div",De,[t("h3",Me,i(e.$t("sales_restaurant.register_sale_modal.selected_additionalSupplies")),1),t("table",Ie,[t("thead",null,[t("tr",null,[t("th",null,i(e.$t("sales_restaurant.register_sale_modal.name")),1),t("th",null,i(e.$t("sales_restaurant.register_sale_modal.unit_price")),1),t("th",null,i(e.$t("sales_restaurant.register_sale_modal.quantity")),1),t("th",null,i(e.$t("sales_restaurant.register_sale_modal.actions")),1)])]),t("tbody",null,[(r(!0),c(R,null,D(n.selectedAdditionalSupplies,(a,d)=>(r(),c("tr",{key:d},[t("td",null,i(a.name),1),t("td",null,"S/ "+i(a.price),1),t("td",null,[$(t("input",{type:"number","onUpdate:modelValue":p=>a.quantity=p,min:"1"},null,8,$e),[[U,a.quantity,void 0,{number:!0}]])]),t("td",null,[t("i",{class:"pi pi-trash actions",onClick:p=>l.deleteAdditionalSupply(a.id)},null,8,qe)])]))),128))])])])):S("",!0),n.selectedDishes.length===0&&n.selectedAdditionalSupplies.length===0?(r(),c("div",Te,i(e.$t("sales_restaurant.register_sale_modal.nothing-selected")),1)):S("",!0)]),t("div",Pe,[t("button",{class:"button-cancel",onClick:s[5]||(s[5]=(...a)=>l.closeComponent&&l.closeComponent(...a))},i(e.$t("sales_restaurant.register_sale_modal.cancel")),1),n.selectedDishes.length||n.selectedAdditionalSupplies.length?(r(),c("button",{key:0,class:"button-register",onClick:s[6]||(s[6]=(...a)=>l.registerSale&&l.registerSale(...a))},i(e.$t("sales_restaurant.register_sale_modal.register")),1)):S("",!0)])])])}const Ee=T(Se,[["render",Ne]]),Ve={name:"SalesNotAddedToInventoryModal",components:{SaleDetailModal:Y},data(){return{selectedSales:[],selectedSale:null,showModalSaleDetail:!1,dataSource:[],registered_sales_not_discounted_in_inventory:!1}},computed:{isAllSelected(){return this.selectedSales.length===this.dataSource.length}},methods:{closeComponent(){this.$emit("close")},isSelected(e){return this.selectedSales.includes(e)},toggleSelection(e,s){s?this.selectedSales.includes(e)||this.selectedSales.push(e):this.selectedSales=this.selectedSales.filter(o=>o.code!==e.code)},toggleAllSelection(e){this.selectedSales=e?[...this.dataSource]:[]},async openSaleDetail(e){try{const s=e.id,[o,u,n,l]=await Promise.all([this.salesRecipeService.getByQuery("sale_id",s),this.salesAdditionalSupplyService.getByQuery("sale_id",s),this.recipeService.getAll(),this.supplyService.getAll()]),a=o.data,d=u.data,p=n.data,h=l.data,k=a.map(f=>{const _=p.find(y=>y.id===f.recipe_id);return{name:(_==null?void 0:_.name)||"Desconocido",unitPrice:(_==null?void 0:_.total_price)||0,quantity:f.quantity}}),I=d.map(f=>{const _=h.find(y=>y.id===f.supply_id);return{name:(_==null?void 0:_.name)||"Desconocido",unitPrice:(_==null?void 0:_.price)||0,quantity:f.quantity}});this.selectedSale={...e,dishes:k,additionalSupplies:I},console.log("Selected sale enriched:",this.selectedSale),this.showModalSaleDetail=!0}catch(s){console.error("Error loading sale details:",s)}},closeSaleDetailModal(){this.showModalSaleDetail=!1,this.selectedSale=null},async registerSalesToInventory(){try{const[e,s,o,u,n,l]=await Promise.all([this.restaurantSaleService.getAll(),this.batchService.getAll(),this.salesAdditionalSupplyService.getAll(),this.salesRecipeService.getAll(),this.recipeService.getAll(),this.recipeSupplyService.getAll()]),a=e.data,d=s.data,p=o.data,h=u.data,k=n.data,I=l.data,f=this.selectedSales,_=new Map;for(const v of f){const M=h.filter(m=>m.sale_id===v.id);for(const m of M){const g=I.filter(A=>A.recipe_id===m.recipe_id);for(const A of g){const J=_.get(A.supply_id)||0;_.set(A.supply_id,J+A.quantity*m.quantity)}}const C=p.filter(m=>m.sale_id===v.id);for(const m of C){const g=_.get(m.supply_id)||0;_.set(m.supply_id,g+m.quantity)}}const y=[];for(const[v,M]of _.entries()){let C=M;const m=d.filter(g=>g.supply_id===v&&g.stock>0).sort((g,A)=>new Date(g.expiration_date)-new Date(A.expiration_date));for(const g of m){if(C<=0)break;const A=Math.min(g.stock,C);g.stock-=A,C-=A,y.push({...g})}C>0&&console.warn(`❌ Insufficient stock for supply_id ${v}. Missing: ${C}`)}const W=y.map(v=>this.batchService.update(v.id,v)),j=f.map(v=>{const M=a.find(C=>C.id===v.id);return M?this.restaurantSaleService.update(v.id,{...M,added_inventory:!0}):Promise.resolve()});await Promise.all([...W,...j]),setTimeout(()=>{this.$emit("refecth_sales_updated_in_inventory"),this.$emit("show-toast","Successfully discounted from inventory"),this.closeComponent()},300)}catch(e){console.error("❌ Error en registerSalesToInventory:",e)}},async getAllSalesWithDetails(){try{const[e,s,o]=await Promise.all([this.restaurantSaleService.getAll(),this.salesRecipeService.getAll(),this.salesAdditionalSupplyService.getAll()]),u=new Map;s.data.forEach(l=>{const a=l.sale_id??0;u.set(a,(u.get(a)||0)+(l.quantity??0))});const n=new Map;o.data.forEach(l=>{const a=l.sale_id??0;n.set(a,(n.get(a)||0)+(l.quantity??0))}),this.salesNotAddedToInventoryWithRecipeAndSupplyCounts=e.data.filter(l=>l.added_inventory===!1).map(l=>({id:l.id,code:l.code,diner_name:l.diner_name,recipeCount:u.get(l.id??-1)||0,additionalSupplyCount:n.get(l.id??-1)||0})),this.dataSource=[...this.salesNotAddedToInventoryWithRecipeAndSupplyCounts],this.dataSource.length>0&&(this.registered_sales_not_discounted_in_inventory=!0),console.log("salesNotAddedToInventoryWithRecipeAndSupplyCounts:",this.salesNotAddedToInventoryWithRecipeAndSupplyCounts)}catch(e){console.error("Error al obtener detalles de ventas:",e)}}},created(){this.restaurantSaleService=new H,this.salesRecipeService=new F,this.salesAdditionalSupplyService=new O,this.recipeService=new E,this.supplyService=new V,this.batchService=new K,this.recipeSupplyService=new G,this.getAllSalesWithDetails()}},We={class:"title"},Be={key:0,class:"sub-text"},Ue={key:1,class:"select-all"},Le=["checked","indeterminate"],Qe={key:0,class:"content"},He={class:"custom-table"},Fe={class:"actions"},Oe={class:"separate"},Ye=["onClick"],je=["checked","onChange"],Je={key:1,class:"no-registros"},ze={class:"buttons"};function Ge(e,s,o,u,n,l){const a=w("SaleDetailModal");return r(),c("div",{class:"modal-overlay",onClick:s[5]||(s[5]=(...d)=>l.closeComponent&&l.closeComponent(...d))},[t("div",{class:"modal-content modal-scrollable",onClick:s[4]||(s[4]=N(()=>{},["stop"]))},[t("button",{class:"close-button",onClick:s[0]||(s[0]=(...d)=>l.closeComponent&&l.closeComponent(...d))},"✕"),t("div",null,[t("h2",We,i(e.$t("sales_restaurant.sales_not_added_in_inventory.title")),1),n.registered_sales_not_discounted_in_inventory?(r(),c("p",Be,i(e.$t("sales_restaurant.sales_not_added_in_inventory.subtitle")),1)):S("",!0),n.registered_sales_not_discounted_in_inventory?(r(),c("div",Ue,[t("input",{type:"checkbox",checked:l.isAllSelected,indeterminate:n.selectedSales.length>0&&!l.isAllSelected,onChange:s[1]||(s[1]=d=>l.toggleAllSelection(d.target.checked))},null,40,Le),t("label",null,i(e.$t("sales_restaurant.sales_not_added_in_inventory.selectAll")),1)])):S("",!0)]),n.registered_sales_not_discounted_in_inventory?(r(),c("div",Qe,[t("table",He,[t("thead",null,[t("tr",null,[t("th",null,i(e.$t("sales_restaurant.sales_not_added_in_inventory.code")),1),t("th",null,i(e.$t("sales_restaurant.sales_not_added_in_inventory.quantityDishes")),1),t("th",null,i(e.$t("sales_restaurant.sales_not_added_in_inventory.quantityAdditionalSupplies")),1),t("th",null,i(e.$t("sales_restaurant.sales_not_added_in_inventory.actions")),1)])]),t("tbody",null,[(r(!0),c(R,null,D(n.dataSource,d=>(r(),c("tr",{key:d.id},[t("td",null,i(d.code),1),t("td",null,i(d.recipeCount),1),t("td",null,i(d.additionalSupplyCount),1),t("td",Fe,[t("div",Oe,[t("span",{class:"pi pi-file",onClick:p=>l.openSaleDetail(d)},null,8,Ye),t("input",{type:"checkbox",checked:l.isSelected(d),onChange:p=>l.toggleSelection(d,p.target.checked)},null,40,je)])])]))),128))])])])):S("",!0),n.registered_sales_not_discounted_in_inventory?S("",!0):(r(),c("p",Je,"There are no sales that have not been deducted from inventory.")),t("div",ze,[t("button",{class:"button-cancel",onClick:s[2]||(s[2]=(...d)=>l.closeComponent&&l.closeComponent(...d))},[L(i(e.$t("sales_restaurant.sales_not_added_in_inventory.cancel"))+" ",1),s[6]||(s[6]=t("i",{class:"pi pi-times"},null,-1))]),n.registered_sales_not_discounted_in_inventory?(r(),c("button",{key:0,class:"button-register",onClick:s[3]||(s[3]=(...d)=>l.registerSalesToInventory&&l.registerSalesToInventory(...d))},[L(i(e.$t("sales_restaurant.sales_not_added_in_inventory.register"))+" ",1),s[7]||(s[7]=t("i",{class:"pi pi-check-circle"},null,-1))])):S("",!0)])]),n.showModalSaleDetail?(r(),q(a,{key:0,sale:n.selectedSale,onClose:l.closeSaleDetailModal},null,8,["sale","onClose"])):S("",!0)])}const Ke=T(Ve,[["render",Ge],["__scopeId","data-v-0d07a846"]]),Xe={name:"sales",components:{SaleDetailComponent:Y,RegisterSaleComponent:Ee,ShowSalesNotAddedToInventoryComponent:Ke},setup(){return{toast:z()}},data(){return{restaurantSaleService:null,salesAdditionalSupplyService:null,recipeService:null,supplyService:null,showModalRegisterSale:!1,showModalSaleConfirmation:!1,showModalSalesNotAddedToInventory:!1,showModalSaleDetail:!1,salesWithRecipeAndSupplyCounts:[],showHistorySalesAddedInInventory:!0,selectedSale:null,filteredSales:[],filterValue:""}},methods:{generateRandomCode(e=6){const s="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let o="";for(let u=0;u<e;u++)o+=s.charAt(Math.floor(Math.random()*s.length));return o},getRandomName(){const e=["Juan","María","Luis","Ana","Pedro","Lucía","Carlos","Sofía","Miguel","Valeria"];return e[Math.floor(Math.random()*e.length)]},async onRegisterSale(e){try{console.log("Registering sale with data: ",e);const s=new Date,o=`${s.getFullYear()}-${(s.getMonth()+1).toString().padStart(2,"0")}-${s.getDate().toString().padStart(2,"0")}`,u={code:this.generateRandomCode(),diner_name:this.getRandomName(),admin_restaurant_id:1,date:o,added_inventory:!1},l=(await this.restaurantSaleService.create(u)).id;console.log("Venta registrada con ID:",l);const a=Array.isArray(e.dishes)?e.dishes.map(p=>{const h={sale_id:l,recipe_id:p.id,quantity:p.quantity};return this.salesRecipeService.create(h)}):[],d=Array.isArray(e.additionalSupplies)?e.additionalSupplies.map(p=>{const h={sale_id:l,supply_id:p.id,quantity:p.quantity};return this.salesAdditionalSupplyService.create(h)}):[];await Promise.all([...a,...d]),console.log("Todos los registros creados exitosamente"),setTimeout(()=>{this.getAllSalesWithDetails()},300),this.showToastSuccess("Sale created succesfully"),this.showModalRegisterSale=!1}catch(s){console.error("Error al registrar venta:",s)}},openRegisterSaleModal(){this.showModalRegisterSale=!0},openSalesNotAddedToInventoryModal(){this.showModalSalesNotAddedToInventory=!0},async openSaleDetail(e){console.log("Opening sale detail for:",e);const s=e.id;try{const[o,u,n,l]=await Promise.all([this.salesRecipeService.getByQuery("sale_id",s),this.salesAdditionalSupplyService.getByQuery("sale_id",s),this.recipeService.getAll(),this.supplyService.getAll()]),a=o.data.map(p=>{const h=n.data.find(k=>k.id===p.recipe_id);return{name:(h==null?void 0:h.name)||"Desconocido",unitPrice:(h==null?void 0:h.total_price)||0,quantity:p.quantity}}),d=u.data.map(p=>{const h=l.data.find(k=>k.id===p.supply_id);return{name:(h==null?void 0:h.name)||"Desconocido",unitPrice:(h==null?void 0:h.price)||0,quantity:p.quantity}});this.selectedSale={...e,dishes:a,additionalSupplies:d},console.log("Selected sale enriched:",this.selectedSale),this.showModalSaleDetail=!0}catch(o){console.error("Error loading sale details:",o)}},closeSaleDetailModal(){this.showModalSaleDetail=!1},async getAllSalesWithDetails(){try{const[e,s,o]=await Promise.all([this.restaurantSaleService.getAll(),this.salesRecipeService.getAll(),this.salesAdditionalSupplyService.getAll()]),u=new Map;s.data.forEach(l=>{const a=l.sale_id??0;u.set(a,(u.get(a)||0)+(l.quantity??0))});const n=new Map;o.data.forEach(l=>{const a=l.sale_id??0;n.set(a,(n.get(a)||0)+(l.quantity??0))}),this.salesWithRecipeAndSupplyCounts=e.data.filter(l=>l.added_inventory===!0).map(l=>({id:l.id,code:l.code,diner_name:l.diner_name,recipeCount:u.get(l.id??-1)||0,additionalSupplyCount:n.get(l.id??-1)||0})),this.filteredSales=this.salesWithRecipeAndSupplyCounts,this.salesWithRecipeAndSupplyCounts.length===0&&(this.showHistorySalesAddedInInventory=!1)}catch(e){console.error("Error al obtener ventas con detalles:",e)}},showToastSuccess(e){this.$toast.add({severity:"success",summary:"Success",detail:e,life:3e3})}},watch:{filterValue(e){this.filteredSales=this.salesWithRecipeAndSupplyCounts.filter(s=>{var o;return(o=s.code)==null?void 0:o.toLowerCase().includes(e.toLowerCase())})}},created(){this.restaurantSaleService=new H,this.salesRecipeService=new F,this.salesAdditionalSupplyService=new O,this.recipeService=new E,this.supplyService=new V,this.getAllSalesWithDetails()}},Ze={class:"ventas-container"},xe={class:"ventas-header"},et={class:"text-question"},tt={key:0,class:"ventas-empty"},st={key:1},lt={class:"flex-title-history-sales"},at={class:"subtitle"},it={class:"table-container"},nt=["onClick"];function ot(e,s,o,u,n,l){const a=w("pv-toast"),d=w("pv-button"),p=w("pv-input-text"),h=w("pv-column"),k=w("pv-data-table"),I=w("SaleDetailComponent"),f=w("RegisterSaleComponent"),_=w("ShowSalesNotAddedToInventoryComponent");return r(),c(R,null,[b(a,{position:"top-right"}),t("div",Ze,[t("div",xe,[t("h2",null,i(e.$t("sales_restaurant.register_sale")),1),b(d,{label:e.$t("sales_restaurant.new_sale"),icon:"pi pi-plus",iconPos:"right",class:"nueva-venta-btn",onClick:l.openRegisterSaleModal},null,8,["label","onClick"])]),s[5]||(s[5]=t("hr",{class:"my-3 border-top-1 border-300"},null,-1)),t("p",et,i(e.$t("sales_restaurant.update_inventory")),1),b(d,{class:"registered-sales-btn",onClick:l.openSalesNotAddedToInventoryModal,icon:"pi pi-list",iconPos:"right",label:e.$t("sales_restaurant.registered_sales_not_discounted")},null,8,["onClick","label"]),n.showHistorySalesAddedInInventory?S("",!0):(r(),c("div",tt,s[3]||(s[3]=[t("p",{class:"ventas-text"}," You currently have no recorded sales. Enter your sales here to keep your inventory up to date. ",-1),t("i",{class:"pi pi-server ventas-icon"},null,-1)]))),n.showHistorySalesAddedInInventory?(r(),c("div",st,[t("div",lt,[s[4]||(s[4]=t("i",{class:"pi pi-history"},null,-1)),t("p",null,i(e.$t("sales_restaurant.history_sales")),1)]),t("p",at,i(e.$t("sales_restaurant.registered_sales")),1),b(p,{modelValue:n.filterValue,"onUpdate:modelValue":s[0]||(s[0]=y=>n.filterValue=y),placeholder:e.$t("sales_restaurant.search"),class:"filter-field"},null,8,["modelValue","placeholder"]),t("div",it,[b(k,{value:n.filteredSales,paginator:!0,rows:10,rowsPerPageOptions:[5,10,15],responsiveLayout:"scroll",class:"full-width-table"},{default:Q(()=>[b(h,{field:"code",header:e.$t("sales_restaurant.code")},null,8,["header"]),b(h,{field:"recipeCount",header:e.$t("sales_restaurant.quantity_dishes")},null,8,["header"]),b(h,{field:"additionalSupplyCount",header:e.$t("sales_restaurant.quantity_additional_supplies")},null,8,["header"]),b(h,{header:e.$t("sales_restaurant.actions")},{body:Q(({data:y})=>[t("i",{class:"pi pi-file",style:{cursor:"pointer"},onClick:W=>l.openSaleDetail(y)},null,8,nt)]),_:1},8,["header"])]),_:1},8,["value"])])])):S("",!0),n.showModalSaleDetail?(r(),q(I,{key:2,sale:n.selectedSale,onClose:l.closeSaleDetailModal},null,8,["sale","onClose"])):S("",!0),n.showModalRegisterSale?(r(),q(f,{key:3,onClose:s[1]||(s[1]=y=>n.showModalRegisterSale=!1),onRegisterSale:l.onRegisterSale},null,8,["onRegisterSale"])):S("",!0),n.showModalSalesNotAddedToInventory?(r(),q(_,{key:4,onClose:s[2]||(s[2]=y=>n.showModalSalesNotAddedToInventory=!1),onRefecth_sales_updated_in_inventory:l.getAllSalesWithDetails,onShowToast:l.showToastSuccess},null,8,["onRefecth_sales_updated_in_inventory","onShowToast"])):S("",!0)])],64)}const pt=T(Xe,[["render",ot]]);export{pt as default};
